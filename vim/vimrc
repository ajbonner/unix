" use pathogen to manage plugins
filetype off 
call pathogen#helptags()
call pathogen#runtime_append_all_bundles('bundles')
syntax on
filetype plugin indent on

" we dont care about compatibility with vi
set nocompatible

" set yanks to go to the clipboard
if $TMUX == ''
  set clipboard+=unnamed
endif

" time to wait after ESC (default causes an annoying delay)
set timeoutlen=250

" gui options
:set guioptions-=m  "remove menu bar
:set guioptions-=T  "remove toolbar
:set guioptions-=r  "remove right-hand scroll bar
:set guifont=Inconsolata:h16

" remap the leader to something more friendly
let mapleader = ","
set timeout timeoutlen=1000 ttimeoutlen=150

" reload and edit vimrc
nnoremap <leader>sv :source $MYVIMRC<CR>
nnoremap <leader>ev :vsplit $MYVIMRC<CR>

" edit bundle config
nnoremap <leader>eb :vsplit $HOME/.vim/update_bundles<CR>

" save buffer as root
nnoremap <leader>sr :w !sudo tee %<CR>

" format and indent xml using xmllint
au FileType xml setlocal equalprg=xmllint\ --format\ --recover\ -\ 2>/dev/null

" whitespace options
set tabstop=4
set shiftwidth=4
set expandtab
set smarttab
set ai       " auto indent
set si       " use smart indenting
set backspace=indent,eol,start
set nowrap   " no wrapping
set wrapscan " scan for wrapping

" search options
" incremental search (search as you type)
set incsearch 

" line numbering
set nu 

" setup and show ruler
set ruler
set textwidth=80
set colorcolumn=80
set formatoptions=qrn1

" show mode in status bar
set showmode
set showcmd

" set color scheme
set t_Co=256
colorscheme wombat256mod

" override filetype indent rules
autocmd Filetype html setlocal ts=2 sts=2 sw=2
autocmd Filetype xml setlocal ts=2 sts=2 sw=2
autocmd Filetype sh setlocal ts=2 sts=2 sw=2
autocmd Filetype ruby setlocal ts=2 sts=2 sw=2
autocmd Filetype javascript setlocal ts=2 sts=2 sw=2
autocmd Filetype make setlocal noexpandtab

" make twig files use jinja syntax rules
au BufRead,BufNewFile *.twig set filetype=htmljinja

" enable syntax autocompletion
filetype plugin on
set ofu=syntaxcomplete#Complete
set completeopt=menu,preview
" for PHP
autocmd FileType php set omnifunc=phpcomplete#CompletePHP
let php_sql_query=1                                                                                        
let php_htmlInStrings=1
" for Ruby
autocmd FileType ruby,eruby set omnifunc=rubycomplete#Complete
autocmd FileType ruby,eruby let g:rubycomplete_buffer_loading = 1
autocmd FileType ruby,eruby let g:rubycomplete_rails = 1
autocmd FileType ruby,eruby let g:rubycomplete_classes_in_global = 1

" Line numbering toggle
map <leader>gn :set invnu<CR>

" Nerd tree setup
nmap <silent> <c-n> :NERDTreeToggle<CR>

" Set up nice buffer switching
set hidden " maybe I want to switch buffers without saving
set wildchar=<Tab> wildmenu wildmode=full
set wildcharm=<C-Z>
set wildignore+=*/.git/*,*/.hg/*,*/.svn/*,*cache*

nnoremap <F10> :b <C-Z>
nnoremap <silent> <F12> :bn<CR>
nnoremap <silent> <S-F12> :bp<CR>
nnoremap <silent> <M-F12> :BufExplorer<CR>

" Use ctrl-motion to switch between windows
nnoremap <silent> <C-h> <C-w>h
nnoremap <silent> <C-j> <C-w>j
nnoremap <silent> <C-k> <C-w>k
nnoremap <silent> <C-l> <C-w>l

" CTags setup
nnoremap <silent> <F8> :TlistToggle<CR>
set tags=tags;$HOME " this will look in the current directory for 'tags', and work up until $HOME
let Tlist_php_settings = 'php;c:class;f:function;d:constant'
let Tlist_File_Fold_Auto_Close = 1
let Tlist_WinWidth = 40
let Tlist_Close_on_Select = 1
let Tlist_Exit_OnlyWindow = 1
